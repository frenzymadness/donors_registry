{% extends "layout.html" %}
{% block content %}

<h1>Přehled dárců</h1>

<table id="overview" class="table table-striped table-hovered table-hover">
    <thead class="thead-dark">
        <tr>
            {% for column_class, column_name in column_names.items() %}
            <th class="{{ column_class }}">{{ column_name }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>

    </tbody>
</table>

{% endblock %}

{% block js %}
<script type="text/javascript">
    function create_tooltip_for_donations(data) {
        var title = ``;
        Object.keys(data).forEach((slug, index) => {
            title += `${data[slug]["name"]}: ${data[slug]["count"]}\n`;
        });
        return `<span data-toggle="modal" data-target="#titleModal" title="${title}">❓</span>`;
    }

    $(document).ready( function () {
        $('#overview').DataTable({
            language: {
                url: '//cdn.datatables.net/plug-ins/1.10.21/i18n/Czech.json'
            },
            "processing": true,
            "serverSide": true,
            "ajax": "{{ url_for('donor.overview_data') }}",
            "columns": [
                {% for column_class in column_names.keys() -%}
                    {"data": "{{ column_class }}"},
                {%- endfor %}
            ],
            "columnDefs": [{
                "targets": "rodne_cislo",
                "render": function ( data, type, row, meta ) {
                  return "<a href='"+"{{ url_for('donor.detail', rc='REPLACE_ME') }}".replace("REPLACE_ME", row.rodne_cislo) + "'>" + row.rodne_cislo + "</a>";}
            },{
                "targets": "donations",
                "render": function ( data, type, row, meta ) {
                  return data.total + create_tooltip_for_donations(data);}
            },]
        });
    } );
</script>

{% include "title_popup.html" %}
{% endblock %}
